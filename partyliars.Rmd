How Many Liars Are At This Party?
========================================================

I've recently taken an interest in learning R. When I learn a new language I typically find it best to read some but to quickly move onto applying the language to a problem. Examples only take me so far before building my own becomes the next step in learning.

This weekend I was reading Dan Ariely's column in the Wall Street Journal entitled "A New Party Game: Who's Dishonest?" (9/14/13) Dan proposes a party game where each guest gets a coin. They predict the outcome of their coin flip, flip the coin, and then report if they predicted the result correctly. If they predicted correctly then they get a drink. If they predicted incorrectly they get nothing. The incentive to lie is clear.

He then summarizes:

> For each 1% of "correct predictions" above 50% you can tell that 2% more of the guests are dishonest.

As a learning exercise I wanted to model this odd party in R.

```{r}
# How many guests are at this party
guests <- 1000
```

Its a really big party. Now to start flipping coins:

```{r}
# Every guest makes a prediction and then flips a coin.
predictions <- sample(c("TAILS", "HEADS"), guests, replace=TRUE)
flips <- sample(c("TAILS", "HEADS"), guests, replace=TRUE)

# If their prediction matches the flip then they were correct
correct <- predictions == flips
```

The predictions are generated by sampling, with even probability, between HEADS and TAILS. I'll use this function with weighted sampling later. Then the code makes a boolean comparison along the length of the array returning an array indicating if the predicitons were true. That's a nice feature of R... the set of data could be huge but the algorithm is not complicated by loops iterating over data.

```{r}
# How many were actually correct? Should be around 50%
p_correct <- length(correct[correct == TRUE]) / guests
```

In this run ```r p_correct*100```% of the guests guessed correctly. Now to find some liars. I wanted to create a graph showing the percentage reporting a correct guess as the percentage of liars increased. To do this first I create an array that ranges from 0% to 100% liars in steps of 1%:

```{r}
# But some are liars! We will test the percentage of liars increasing in 1% increments
p_liars <- seq(from=0, to=1, by=0.01)
```

Next I wrote a function that takes a single value, the percentage of liars at the party, and then experimentally calculates the number of guests who would then claim that they guessed correctly.

```{r}
percentReportedHeads <- function(p_liar) {
  # Create an array where p_liar percentage of the guests are liars
  liars <- sample(c(TRUE,FALSE), size=length(flips), replace=TRUE, prob=c(p_liar, 1 - p_liar))
  # Those who are liars will lie and claim their prediction was true!
  reported <- correct
  reported[liars == TRUE] <- TRUE

  # return the percentage who claim to have predicted correctly
  return( length(reported[reported==TRUE]) / length(flips))
}
```

The line of code that makes liars out of the guests is this one:

    reported[liars == TRUE] <- TRUE    

This demonstrates a useful feature of R. For each liar at the party this line finds their corresponding prediction (already copied into the `reported` array) and sets it to `TRUE`.

Now that we have this function then apply it to the list of predictions, iterating over the percentage of liars ranging from 0% to 100% and plot:

``````{r fig.width=7, fig.height=6}
# For each percentage of liars we want to display run the function to calculate the result.?
result = sapply(p_liars, percentReportedHeads)

plot(x=p_liars, y=result, 
     main="Each 1% increase in Correct Predictions Implies\n 2% More of Guests are Liars",
     sub="Based on Dan Ariely's 9/14/13 WSJ column 'A New Party Game: Who's Dishonest",
     xlab="Percentage of guests who are liars",
     ylab="Percentage of guests reporting correct prediction",
     ylim=c(0,1)
     )
m <- lm(result ~ p_liars)
abline(m)
```